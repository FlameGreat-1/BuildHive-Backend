generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  CLIENT
  TRADIE
  ENTERPRISE
}

enum UserStatus {
  PENDING_VERIFICATION
  ACTIVE
  SUSPENDED
  INACTIVE
  BANNED
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
  EXPIRED
}

enum DocumentType {
  DRIVERS_LICENSE
  PASSPORT
  ABN_CERTIFICATE
  INSURANCE_CERTIFICATE
  LICENSE_CERTIFICATE
  QUALIFICATION_CERTIFICATE
  PORTFOLIO_IMAGE
  PROFILE_PHOTO
  OTHER
}

enum AuditSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
  INFO
}

enum SubscriptionTier {
  BASIC
  PROFESSIONAL
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  SUSPENDED
}

model User {
  id                      String    @id @default(cuid())
  email                   String    @unique
  passwordHash            String
  firstName               String
  lastName                String
  phone                   String    @unique
  userType                UserType
  status                  UserStatus @default(PENDING_VERIFICATION)
  
  emailVerified           Boolean   @default(false)
  phoneVerified           Boolean   @default(false)
  emailVerificationToken  String?
  phoneVerificationCode   String?
  passwordResetToken      String?
  passwordResetExpires    DateTime?
  
  lastLoginAt             DateTime?
  loginCount              Int       @default(0)
  profileCompleteness     Int       @default(0)
  
  metadata                Json?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  createdBy               String?
  updatedBy               String?
  version                 Int       @default(1)
  isDeleted               Boolean   @default(false)
  deletedAt               DateTime?
  deletedBy               String?
  
  clientProfile           ClientProfile?
  tradieProfile           TradieProfile?
  enterpriseProfile       EnterpriseProfile?
  documents               Document[]
  auditLogs               AuditLog[]
  
  @@map("users")
  @@index([email])
  @@index([phone])
  @@index([userType])
  @@index([status])
  @@index([createdAt])
  @@index([isDeleted])
}

model ClientProfile {
  id                      String    @id @default(cuid())
  userId                  String    @unique
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  companyName             String?
  abn                     String?
  industry                String?
  website                 String?
  description             String?
  preferredContactMethod  String?
  timezone                String?
  
  address                 String?
  city                    String?
  state                   String?
  postcode                String?
  country                 String    @default("Australia")
  
  isVerified              Boolean   @default(false)
  verificationStatus      VerificationStatus @default(PENDING)
  verificationNotes       String?
  
  totalJobsPosted         Int       @default(0)
  totalAmountSpent        Decimal   @default(0) @db.Decimal(10,2)
  averageRating           Decimal?  @db.Decimal(3,2)
  totalReviews            Int       @default(0)
  
  preferences             Json?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  version                 Int       @default(1)
  
  @@map("client_profiles")
  @@index([userId])
  @@index([isVerified])
  @@index([city, state])
}

model TradieProfile {
  id                      String    @id @default(cuid())
  userId                  String    @unique
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  businessName            String?
  abn                     String?
  abnVerified             Boolean   @default(false)
  tradeLicense            String?
  licenseVerified         Boolean   @default(false)
  
  services                String[]
  trades                  String[]
  specializations         String[]
  experienceYears         Int?
  hourlyRate              Decimal?  @db.Decimal(8,2)
  minimumJobValue         Decimal?  @db.Decimal(8,2)
  
  serviceRadius           Int?
  address                 String?
  city                    String?
  state                   String?
  postcode                String?
  country                 String    @default("Australia")
  availableWeekdays       String[]
  availableHours          String?
  
  hasInsurance            Boolean   @default(false)
  insuranceProvider       String?
  insuranceExpiry         DateTime?
  certifications          String[]
  
  description             String?
  portfolio               String[]
  website                 String?
  
  isVerified              Boolean   @default(false)
  verificationStatus      VerificationStatus @default(PENDING)
  verificationNotes       String?
  backgroundCheckStatus   VerificationStatus @default(PENDING)
  
  totalJobsCompleted      Int       @default(0)
  totalEarnings           Decimal   @default(0) @db.Decimal(10,2)
  averageRating           Decimal?  @db.Decimal(3,2)
  totalReviews            Int       @default(0)
  responseRate            Decimal?  @db.Decimal(5,2)
  onTimeRate              Decimal?  @db.Decimal(5,2)
  
  isPremium               Boolean   @default(false)
  premiumExpiry           DateTime?
  featuredUntil           DateTime?
  
  preferences             Json?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  version                 Int       @default(1)
  
  @@map("tradie_profiles")
  @@index([userId])
  @@index([abn])
  @@index([isVerified])
  @@index([city, state])
  @@index([services])
  @@index([isPremium])
  @@index([averageRating])
}

model EnterpriseProfile {
  id                      String    @id @default(cuid())
  userId                  String    @unique
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  companyName             String
  abn                     String
  abnVerified             Boolean   @default(false)
  acn                     String?
  industry                String?
  companySize             String?
  foundedYear             Int?
  
  website                 String?
  linkedinUrl             String?
  description             String?
  
  headOfficeAddress       String?
  city                    String?
  state                   String?
  postcode                String?
  country                 String    @default("Australia")
  
  services                String[]
  serviceAreas            String[]
  projectTypes            String[]
  minimumProjectValue     Decimal?  @db.Decimal(10,2)
  
  teamSize                Int?
  employeeCount           Int?
  maxConcurrentProjects   Int?
  
  isVerified              Boolean   @default(false)
  verificationStatus      VerificationStatus @default(PENDING)
  verificationNotes       String?
  hasInsurance            Boolean   @default(false)
  insuranceProvider       String?
  insuranceExpiry         DateTime?
  
  certifications          String[]
  licenses                String[]
  
  totalProjectsCompleted  Int       @default(0)
  totalRevenue            Decimal   @default(0) @db.Decimal(12,2)
  averageRating           Decimal?  @db.Decimal(3,2)
  totalReviews            Int       @default(0)
  
  subscriptionTier        SubscriptionTier @default(BASIC)
  subscriptionStatus      SubscriptionStatus @default(ACTIVE)
  subscriptionExpiry      DateTime?
  maxTeamMembers          Int       @default(5)
  maxProjects             Int       @default(10)
  
  preferences             Json?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  version                 Int       @default(1)
  
  teamMembers             EnterpriseTeamMember[]
  
  @@map("enterprise_profiles")
  @@index([userId])
  @@index([abn])
  @@index([isVerified])
  @@index([city, state])
  @@index([subscriptionTier])
  @@index([services])
}

model EnterpriseTeamMember {
  id                      String    @id @default(cuid())
  enterpriseProfileId     String
  enterpriseProfile       EnterpriseProfile @relation(fields: [enterpriseProfileId], references: [id], onDelete: Cascade)
  
  email                   String
  firstName               String
  lastName                String
  role                    String
  permissions             String[]
  
  isActive                Boolean   @default(true)
  invitedAt               DateTime  @default(now())
  joinedAt                DateTime?
  lastActiveAt            DateTime?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  @@map("enterprise_team_members")
  @@unique([enterpriseProfileId, email])
  @@index([enterpriseProfileId])
  @@index([email])
}

model Document {
  id                      String    @id @default(cuid())
  userId                  String
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fileName                String
  originalName            String
  fileSize                Int
  mimeType                String
  documentType            DocumentType
  
  storageUrl              String
  thumbnailUrl            String?
  
  isVerified              Boolean   @default(false)
  verificationStatus      VerificationStatus @default(PENDING)
  verificationNotes       String?
  verifiedAt              DateTime?
  verifiedBy              String?
  
  metadata                Json?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  version                 Int       @default(1)
  isDeleted               Boolean   @default(false)
  deletedAt               DateTime?
  
  @@map("documents")
  @@index([userId])
  @@index([documentType])
  @@index([verificationStatus])
  @@index([createdAt])
  @@index([isDeleted])
}

model AuditLog {
  id                      String    @id @default(cuid())
  userId                  String?
  user                    User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  action                  String
  resource                String
  resourceId              String?
  
  oldValues               Json?
  newValues               Json?
  
  ipAddress               String?
  userAgent               String?
  requestId               String?
  
  severity                AuditSeverity @default(LOW)
  category                String?
  
  description             String?
  metadata                Json?
  timestamp               DateTime  @default(now())
  
  createdAt               DateTime  @default(now())
  
  @@map("audit_logs")
  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([resourceId])
  @@index([severity])
  @@index([createdAt])
}
